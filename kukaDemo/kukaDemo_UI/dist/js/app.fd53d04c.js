webpackJsonp([1],{"+VGo":function(t,e){},0:function(t,e,s){t.exports=s("NHnr")},1:function(t,e){},"3qvW":function(t,e,s){t.exports=s.p+"img/chainstep.e5690373.svg"},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("/5sW"),n=s("Sgar"),i={name:"ShippingProgress",props:{steps:Array},methods:{completed:function(t){var e="SPAN"===t.target.tagName?t.target.id:t.target.parentElement.id;this.$emit("completed",Number(e),new Date)},strftime:n}},c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"progress-indicator"},t._l(t.steps,function(e,a){return s("li",{key:a,class:{completed:e.timestamp,completed_right:e.timestamp&&a+1<t.steps.length&&t.steps[a+1].timestamp,completed_left:e.timestamp&&a>0&&t.steps[a-1].timestamp}},[s("span",{staticClass:"bubble",attrs:{id:a},on:{click:function(e){return e.preventDefault(),t.completed(e)}}},[s("transition",{attrs:{name:"custom-classes-transition","enter-active-class":"animated bounceInLeft"}},[e.action?s("i",{key:"icon",class:e.action}):t._e()])],1),s("span",{staticClass:"text"},[s("div",[s("span",[t._v(t._s(e.text))]),s("transition",{attrs:{name:"custom-classes-transition","enter-active-class":"animated bounceInLeft"}},[e.timestamp?s("span",{key:"timestamp",staticClass:"time"},[t._v(t._s(null!==e.timestamp?t.strftime("%H:%M:%S",e.timestamp):""))]):t._e()])],1)])])}))},o=[],r=s("XyMi");function l(t){s("SUAc")}var p=!1,d=l,u="data-v-4fd96d51",m=null,f=Object(r["a"])(i,c,o,p,d,u,m),g=f.exports,h=s("DmT9"),_=s.n(h),v={name:"app",components:{ShippingProgress:g},data:function(){return{fake_blockchain:!1,transaction_in_progress:null,contract:{address:null,steps:[{timestamp:null,text:"Order placed"},{timestamp:null,text:"Delivery service selected"},{timestamp:null,text:"Parcel code registered"},{timestamp:null,text:"Delivery"},{timestamp:null,text:"Delivery service on site"},{timestamp:null,text:"Parcel delivered"}]},socket:_()()}},mounted:function(){var t=this;console.log("mounted");var e=this;this.socket.on("data",function(s){t.transaction_in_progress=null,console.log("received data "+JSON.stringify(s)),e.fake_completed(s.step,new Date)}),this.socket.on("new contract",function(s){t.transaction_in_progress=null,console.log("new contract deployed "+s.address),s&&s.address?(e.reset(),e.contract.address=s.address):console.error("Ignoring new and imcomplete contract")}),this.socket.on("status changed",function(s){if(console.log("status changed "+s.address),t.transaction_in_progress=null,s&&s.address&&e.contract.address==s.address){var a=new Date;a.setTime(s.timestamp),e.fake_completed(s.step,a)}else console.error("Ignoring status update with wrong contract address")}),this.socket.on("ACK",function(e){console.log("ACK "+e),t.transaction_in_progress=e})},methods:{emit:function(t,e,s){if(console.log("emit :"+t),!this.transaction_in_progress)return this.transaction_in_progress="submitted "+t,this.socket.emit(t,e,s)},advance:function(){console.log("advance");for(var t=0;t<this.contract.steps.length;t++)if(!this.contract.steps[t].timestamp)break;this.emit("advance",t,function(t){console.log(t)})},order:function(){console.log("place order"),this.emit("place order",null,function(t){console.log(t)})},ready_to_accept:function(){return this.contract.steps.slice(0,-1).reduce(function(t,e){return t&&e.timestamp},!0)&&!this.contract.steps[this.contract.steps.length-1].timestamp},accept:function(){console.log("accept order"),this.ready_to_accept()&&this.emit("advance",this.contract.steps.length-1,function(t){console.log(t)})},reset:function(){this.fake_completed(0,null)},fake_completed:function(t,e){if(t<0||t>=this.contract.steps.length)throw"ignoring illegal idx "+t;if(0===t&&this.contract.steps[t].timestamp){console.log("reseting status"),this.contract.address=null;for(var s=0;s<this.contract.steps.length;s+=1)this.contract.steps[s].timestamp=null,this.contract.steps[s].action=null}else{if(t>0&&null===this.contract.steps[t-1].timestamp)throw"ignoring update of idx "+t+", complete the previous entry first";if(null!==this.contract.steps[t].timestamp)throw"ignoring update of idx "+t+", already up to date";this.contract.steps[t].timestamp=e,0===t?(console.log("updating action"),this.contract.steps[t].action="fa fa-shopping-cart"):1===t?this.contract.steps[t].action="fa fa-search":2===t?this.contract.steps[t].action="fa fa-tag":3===t?this.contract.steps[t].action="fa fa-truck":4===t?this.contract.steps[t].action="fa fa-home":5===t&&(this.contract.steps[t].action="fa fa-check")}}}},C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app container"}},[t.contract.address?t._e():s("div",{staticClass:"overlay"},[s("div",{staticClass:"white"}),s("button",{staticClass:"btn btn-lg order text-uppercase",on:{click:function(e){return e.preventDefault(),t.order(e)}}},[t.transaction_in_progress?s("i",{staticClass:"fa fa-spinner fa-spin"}):s("i",{staticClass:"fa fa-shopping-cart"}),t._v("\n            Place order")])]),t.ready_to_accept()?s("div",{staticClass:"overlay"},[s("div",{staticClass:"white"}),s("button",{staticClass:"btn btn-lg order text-uppercase",on:{click:function(e){return e.preventDefault(),t.accept(e)}}},[t.transaction_in_progress?s("i",{staticClass:"fa fa-spinner fa-spin"}):s("i",{staticClass:"fa fa-check"}),t._v("\n            Accpet order")])]):t._e(),t._m(0),s("div",{staticClass:"row indentL"},[s("div",{staticClass:"col col-sm-3 headerL"},[t.contract.steps[0].timestamp?s("button",{staticClass:"btn cancel text-uppercase",on:{click:function(e){return e.preventDefault(),t.reset(e)}}},[t.contract.steps[t.contract.steps.length-1].timestamp?s("span",[s("i",{staticClass:"fa fa-undo"}),t._v(" Start again")]):s("span",[s("i",{staticClass:"fa fa-times"}),t._v(" Cancel")])]):t._e()])]),s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("ShippingProgress",{attrs:{steps:t.contract.steps},on:{completed:t.fake_completed}})],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.transaction_in_progress,expression:"transaction_in_progress"}],staticClass:"progress"},[s("button",{staticClass:"btn btn-light"},[s("i",{staticClass:"fa fa-spinner fa-spin"}),t._v(" "+t._s(t.transaction_in_progress)+"\n        ")])])])},k=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row"},[a("div",{staticClass:"col headerL"},[a("img",{staticClass:"logo",attrs:{src:s("3qvW")}})])])}];function b(t){s("+VGo")}var w=!1,x=b,y=null,D=null,S=Object(r["a"])(v,C,k,w,x,y,D),P=S.exports;a["a"].config.productionTip=!1,new a["a"]({render:function(t){return t(P)}}).$mount("#app")},SUAc:function(t,e){}},[0]);
//# sourceMappingURL=app.fd53d04c.js.map